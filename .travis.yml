services:
  - docker

env:
  global:
  - secure: "Iy6eJOGhkI16n/Pp/LiTCN+leFommiQKVAQLHmHrFEdbyg2Sef2JdilCPZUhXy89LdpMmDQngwAsTBMdc89bqk1uuQxgiiqcLVM3o6OwalIQeY7E9NWYuNyZD21TvFAcd6ygwn5a34vRxoahRHppNmpLci2H42UALhDy2JpFUyJ2eD1nUbNHdXppxzfMJqpSvHdH7fgOL/Ki+lEQ4wvFqBlGyzGGUVbxjr8pySbVmCAQlj+wDkvQws45pE5EyfC3DzCuWKt8mLzJx2i9jlar+FDLt4CQs5ef80VQdNb4TLYfj3kSD/4cECemWO9VOOjIREWg2dznbehsXoD4Hvxv/u6bj1wjk8mFQVn/9kEoMRvAJruuhHbShdAgvP0BsSdyEVR/sco+aQPxr72ESWkJ77DeRzsMx6WIwo7oWyWHiv9yucw0rhJkTp9PeiMbJXbzd93g3mVJ9ZodFyzSDimqzivkkCSxOotjqa8zG3j0m/zz/7oImstXvfRAmcgqTP5Wyy3FotKQqwHT4tp+fOO/QRGlwSdwIL075usmXY30ZRXrQip390PFEx3RF3Wko5Hy8OMahs0nnnzqO8b77TtsxDxJjRQ9doq+Lh2IOmrGadcYV+mb4dqoBwCpafIp62x4mYumxkrshtEvofKnmna9EqaEdGuK7xa5F8n3h61q+Vo="
  - secure: "wNn6oR0af95Cv1TwMXaLBMisJCmM3HYwni3wRjr/XmAzKxj7/Vhr2cJqoQ9wkgaUd951thfFV5/eSwNahjByFfA3YpINSSYJNl4AT1sp7s2giYVDkQAItNSwfdqFwTvnJHcy7O56WfjCpLEFFZccEnopqG4tQp4HZdKtUyX7b/KchyxoYyPfreQWCjEvDnRvUnYySvzp7aSDn61GHShdi94gzJY+y3s0/edW//gQ8VhUFyQM4gCb6afoKNXKsYMx3+4zVxPgQ8lX/u2NRo0uxrnU9uru9LX/xKtBesQ/P0Pyz1bT6moQaT5CxHIOqcPrGqRRVywKn82yqK3v+IA7Q1N/OzuVNI7hAqT/zICw8bqQulzlaDMCDXKtPsXvVYRR+2IcnPEPrQShQhxW3+JCQmUxXdxbtPsoBrxIQS9A4VbbAQ4hOg8v3ufoRX9ZHrVKX1sSGoOHisAWOb6n/UDKY0gOUlDAl0EYx7f4jRAKWaesfc9Zfd7Y7Jlcme5m8d5nCwJ+916SS1/kAyMiLhtn1aYaNi/0eoRKtdIdRmpqC5SVpRRAc0pH0nkuySPwBavlNlO8yDE70MwmzI8MueUw+jBN00qoEz6nbdBxpKB4vTdfGQ0hzeFBY609rVxFa0+PBS8KMinX1gfKyUKKr0mSt0b9vZezY3BrgAo1ozOuoA8="
  - secure: "Aw9GHVg08eJ58N7EVxwiihvDklyFk+zpTzPHh4sxgi3v3Mc37AXKZF4QnRJ4lZT178tCIqmAl85t1b5vWSJ/5PQn2lhoOHqFoMuwmCcT3ODb6AWFM41joARxPTEVqrerF+K6rjFqE4XQXWQlLvuECTpDUmnf6yRFCy2UNIiFIt9J5XMctCHvhcFW/duzwAEh1VyPLTxD9WOa63YpDLJVsrr48j6EeoPWZsojgcaH8p5nW9M6SEQ22j2SvPzrF1rSMRUGBozPPlHy5HF7Jxw/UOYcdPVS5iIVqp33GJibedHzK/27fB1DHxQjvxNWSa91rc+/Xj9GBM1ZMIwaf7VYWzqE/wKoGwVU1uoAVjHfHC7poT4U23Wr6iOFIKNeb70OTE2+p8+xfZ0LFOCK6VqrgMSqOi9Ic4SVN4BX8ZCqqcrI5NvL/KF+TH3knW6z3ba6gv1v6PqBkwOM6G77ek9RDib73GmCHolmnZB7ZjayfnBRo+FsG+egCh6tgzlwN/QLmMrRE9C/MhXAKdibF7IC28SctnZGW0k8BlysVPZhZ7RBGT7KjgDZgZHw9y4T0gVrTFAGFYJxf5FO4c0MYPcZxb+VWgVEfex1Yz+9PCDTN6OUNUP+y5zxzbXnkoJfTb0NcFNDJAy5lX6H+7ZaGtG7kZGAQnoBIudPtf8ia6CWNWk="
  - secure: "3LgJLuURM/YS80GzsndB1qfq2asMbD9j3E5LVTWjUvWQIpHQFW5uCTG30RoejUMmvE8k+ZeyaoFPoByd/Rv893Fmt2toVs8drfj88OH2dsqxMqplQNvxUbb/gCt/gg116dfoB2emlTsUsC96HF/rJNKUC8k+2uoNTbTKL7rqlz9Mt9Ocrk59Zz3web6rU5Y1xgtmAKN8UWLDf6JcNsi/g9aFdhvWIBWb5lp2800wkhqJu1JIhQ7xW8t3nCMMRovr6MJmaJ91+CL2D9ULhwi7c9wr0Q11VnqnuBNZKkB3LRN62E/cAif3xJALVGxurTDEibD1ut0BqkPGKn48vkrkfAQn5NZmO7wJfNp0Gzyvu4w8VX/ILMJHJuXuzP5/Hbs1XNYfimffq+P7D/OZCOhbX98PAMEYnfuxs7WqKs1uCPAbciHGH1PZdCYAcLao84dNREM3GhJbvBcGuzbQk3iEHWM6dNDrzfdxe/Mtx1uoDQaj6xsulJmlWlA98H15F+ekR59pKe1zPfYi3gfmAk4QybmW18oqWmYAGvIDcvrvdyFh1G7wPXd15V5rkc7HsAwdRmbXTujN9UnW0AhN5Oa+0F54u89OauOoySKUTHv4YH6TPTqhFp373TDLSf9sqj0DXoFghiOEaCtdKX8eHpms23tIUoE32bTf1CVldQoP/Qg="
  - secure: "M4aULg3Vbu6kQbjMc4GXH6h4Ji3mYFPqdrzG1amAIpiktY0LFhqC3hTL8QWNXeIh0rCsOmNIf50VpBQ8S+v2078twfFDCNZnU1wkfQ7ENGiyZU8vLhynXLPWSpgxVYr2T9y82c/KiyNad6JQo+ZBYxtCLUSO9k6hFsN837gv5ejNjP7h9C2rPC4rfhkAihun1kALDW+8y9/NGTqrCHtkhDIByCnpNVYkyNkTmKJYOZ2Oe7A/8+yStSUz0vcu+BObXRTk/lB8WdnB/RbYFcCDDrM/NPuHcse5knwVh4tBII0Ahw5tx1vfUT2ayBdBgxRkuLeqvY83G3lFyCCPoPNitkp6fFm4SlxHyIe0MHDf1gwPbNi95vKYBjy56l6K1Zi+TMXrBSKbq8f3JyrYME4s6TgY2EQI/eVu+npiOp1414s5mXPMaWu/niajCy4CViYM8IT8BUjSIbZYYIUSYWRHrlsGljE3cX7nKHqZ4ldiYPc/zr5Jh7Lkr7/ic4joSPRKupmcYYlhfuLRSBA2kunBnKqHyLVc5GFLrv4Eh1rcz8l+UXosY46no9+qvsUpLdQFid9dAPd2HIy4KHAzxD58nLtpIwqTCMx1jdP5ecZwbjmCN2W0tmQ4LIszHgU+sIQ18CXP470mLWKJgPnE/ngQ93yMYLpHm39iraFhQjAcC10="
  - secure: "lxQBb/9XRIvsmwlnrAEqBQqx0CcPrCxMkthoY256DQ/8qceIZZfJukb+ppfh7EQ2/Ho8nOUttcmDj3eRfOjQGp3t/6kEn2d1AfmOYZ2OB3E7y41FHAl7NYfCbgibdWrT2Sqw5zfgORj21SKFbpNVBza55jFgIGVD37J9rW75YkOx2rAZdAKb7tE4HLN/4lAIzP102KwkXxweUMy89+obgDh5pEJ3pvchAU5BmUJUJkXQ/1i9S9AKKYQRnTWHmSLY3enKmFJCoNkuuL6XsnLMJUQ9hlmFPaVCULeN2+3u7299Ne/wxk7+JrAcoFY1q/DaVl8FKbg70TDkzuKoFyv1ebsvGApEj8fKqOeYxHv7AqxukITVh0YzyfUgMcVNE+WsWFPnxeNXXo5UviBgtqzeCVkDlkd7DGIkso6GsNTWmgyiYs3GKAEtJLqiPheNii1+2kfMXnl6wEjrLKV+okti54HBCd5eE+NpAu7+wL/nay0dEubgUPp9Yoy/LX1ZqLGA4K0ZzXIcEF5ZXq8jI5hPGk3mTNi8ntoFwVE/KRSzJKHoxJr6G/xtmckcRGnYoO1vT9G5RObhMUuA3EW+iv8o0fS3WmJfYpLdjna/+Cdv9EqGR0Mv344DZjlr7r6WvFbQzjUCuqeaC577FegA6TeTYTR9rjo3S6juo9pd8SYw6MA="
  - secure: "cYOBXTce/J6tky0dUMzlViN0xpEMatXR7+/GizUH/muZzx86lKPPrKeiMqOqKj+Au4vqqSt0GhKf56krgNVGb2yB/maXk0cwJzpCN7MnqHrwV/SXSxjdsLozLcGxVOJI2Cc59ETaFKgEE0pgQCLLigIHwwV6OfE1/WLzFFKBlKkVDILh6OZw9p6aW0jSlSiIJv0lHxOrAil7m9B17PGB8DpLhVNaHyVrqyJ1nVwk4jCVy6A11Yr6Q0/VLEVuwZb/PaCBn6AJooV0j9msAhQuxRa0ypvXgezw1OOSGejMW1VF8433/UVTIFrHUlV3Z3axnCGZLBJWJGTOXqVqX7omGhixTrTKrJT0H5NUWjfxkowlCflGjXlzxWLNt7K+nqVyTWljlbvZbwhAllZ+sDMPkD21KWgEeO9nx5biKZhHfToPRL7Ld//p5LGP5+smui6/tuGJpCT5uOmsM+ZkMLu77fGF107RbPxl5XrFuREo/Ix0VCvc04ki/1auwF2tO4IFEJt/jK27WIcHE5br7FnwDZUjvFE0vIqvIS7o7wLzNg2rHO5p2UGAGbThJt0MFzT5ToxuqHh96mK2TaYUsBp0m/MtAoNb8gQhU6sjTKbemfKtNA0PJ7mf8ukue+fXz3iF35sSzNSNKzvm1WiZ53p12EgYAoszX0Xtyz3YESWQBLY="
  - secure: "tSBhcO4FNL5KpvxIDIahKWM3DdWNamuJD7drCkssoLU9F5pTC+hcuGK+OzEUClxo6UbVLtynPppyYWPkBTv8tih0PACxm7mb+D7/Vp2AbET6VA0FY9PbGyz7EDa6VfNchW9mLrsaIBnj6WrFumg3K8aCXLVcpAhrxdXe/8QqMZMurfIEeTKRfqB/PBi6Mbagq5CaDh7ncNMw1sBYmrHcDkHcKod7ws/ngym8JMbY1O0hMeJFpec6i4+gzb2mJRGWv77UGHi+UK1NgK4wDn2bpCiCL1E3jdHkqZtyqPrGop/nhXTmgPgFqauLYqNYz9Bi+K03/hCcE7RBU1vV5V+fZn9rr00nfNyzGMXr0+fz8+bdmBClHgdiS/Q+QGeA0SJDV1pZ/5T9NxGwk+eAcFmqIMEHdngtSfNfnUw2rk0AK/AM5lP0K22KCQLVbkMOBvwTib2U22uC+wW2ljVN3ym69sE+loJQNcTroVtbqQRy+dxprIAxAKhNGE245izbRD077g3OR4TuqBLs0IdfFh2OJJNmh8PBoxFxZRJXDunlOKuV4DHVPbI/e/iIJVYB9zgY75ixOF535NUCodGzrncFCRJuUksj6OSsjKOC+jvC+WbSqZWephrijMItVJuM06IRocu2jL8762w7rTaBcpJdczflTW8Y1kgxgImrljX5Xkg="
  - FLASK_APP="app"
  - FLASK_ENV="development"
  - MONGO_CLUSTER_NAME="cluster0.vwqib.mongodb.net"
  - MONGO_DB_NAME="ppp-board-test"
  - LOGIN_DISABLED=True
  - DOCKER_USERNAME=perryjones
  - DOCKER_REPO=ppp
  - HEROKU_APP_NAME="perfectproductivityplatform"

script:
- docker build --target test --tag my-test-image .
- docker run my-test-image tests
- docker run 
  -e FLASK_APP
  -e FLASK_ENV
  -e MONGO_USERNAME
  -e MONGO_PASSWORD
  -e MONGO_CLUSTER_NAME
  -e MONGO_DB_NAME
  -e LOGIN_DISABLED
  my-test-image tests_e2e

deploy:
  skip_cleanup: true
  provider: script
  script: bash .travis_docker.sh
  on:
    branch: master
    condition: ${TRAVIS_PULL_REQUEST} == "false"
